# ============================================================  run  =============================

# $ make					[linux/mac]
# $ mingw32-make			[windows]

# ============================================================  basic command  ====================

# lcc -o helloworld.gb main.c
# compiler | output | filename | source





# ============================================================  set up  ===========================

NAME 			= gbc-fade

GBDK_HOME		= ../../../tools/gbdk
LCC 			= $(GBDK_HOME)/bin/lcc								# compiler

LCCFLAGS		+= -Wm-yn"$(NAME)"									# set name to rom header
LCCFLAGS		+= -Wm-yC											# GBC only

LCCFLAGS		+= -Wf--opt-code-speed								# optimizations

LCCFLAGS		+= -debug											# debug

BIN_DIR			= ./build

BIN				= $(BIN_DIR)/$(NAME).gb

CSOURCES 		:= $(wildcard src/*.c)		# .c files to build

ERROR_LOG		= echo -e "\n"\
"\033[1;31m===================================================================================================\n"\
"===========================================    ERROR    ===========================================\n"\
"===================================================================================================\n\033[0m"




# ============================================================  do all  ===========================
all: print reset compile success

# ============================================================  log start  ========================
print:
	@echo -e ""
	@echo -e "\033[1;36m ==================================================================================================="
	@echo -e " ===========================================    MAKE    ============================================"
	@echo -e " ===================================================================================================\033[0m"
	@echo -e ""
	@echo -e "\033[0;33m$(NAME).gb\033[0m"
	@echo -e "$(LCC)"
	@echo -e ""
	@echo -e "$(LCCFLAGS)" | tr ' ' '\n' | sed '/^$$/d' | sed 's/^[ \t]*//;s/[ \t]*$$//'
	@echo -e ""

# ============================================================  delete and recreate  ==============
reset:
	@rm -rf $(BIN_DIR) || ($(ERROR_LOG); false)
	@mkdir -p $(BIN_DIR)

# ============================================================  compile  ==========================
compile:	$(BIN)

$(BIN):
	@$(LCC) $(LCCFLAGS) $(CFLAGS) -o $(BIN) $(CSOURCES) $(OBJS) || ($(ERROR_LOG); false)

# ============================================================  log success  ======================
success:
	@echo -e "\033[1;32m ==================================================================================================="
	@echo -e " ==========================================    SUCCESS    =========================================="
	@echo -e " ===================================================================================================\033[0m"
	@echo -e ""

